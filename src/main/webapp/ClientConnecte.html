<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Espace Client</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    </head>
    <body>
        <a href><img src="./img/logo.png" alt="Logo" width="100" height="100" onclick=redirectAccueil()></a>
        <input type='button' name='button1' value='Se déconnecter' onclick="self.location.href='Proactif.html'">
        <!-- attention il faut définir l'alignement des boutons class='pull-right'-->
        <hr/>
    
    <center>
        
        <!-- Tableau historique des demandes -->
        
        <table width="35%" border="3" align="center">
        <tbody>
            <tr>
                <th>
                    <img src="./img/cloche.jpg" alt="Cloche" height="42" width="42">
                    Historiques des demandes :
                    <img src="./img/cloche.jpg" alt="Cloche" height="42" width="42">
                </th>
            </tr>
        </tbody>
        </table>
            <ul id="liste-interventions"></ul>
            
        <h1>
            <img src="./img/star.png" alt="Star" height="42" width="42">
            <input type='button' name='button2' value='Faire une nouvelle demande' onclick=demanderIntervention(idClient)>
            <img src="./img/star.png" alt="Star" height="42" width="42">
        </h1>
    </center>
    
    <script>
        function redirectAccueil(){
            window.location = "ClientConnecte.html?idClient"+idClient;
        }
    
        function demanderIntervention (idClient) {
            window.location = "DemandeIntervention.html?idClient="+idClient;
        }
        
        function afficherHistorique (intervention) {
            for (var i =0; i <intervention.length; i++) {
               $('#liste-interventions').append('<li> Type d\'intervention: '+intervention[i].type+'<br/>'
                                  +'Description de l\'intervention: '+intervention[i].description+'<br/></li>'); 
            }
        }
            
            $(document).ready(function () {
                var parameters = location.search.substring(1).split("=");
                idClient= unescape(parameters[1]);
                $.ajax({
                    url: './ActionServlet',
                    method: 'POST',
                    data: {
                        action: 'consulterHistoriqueClient',
                        idClient: idClient
                    },
                    dataType: 'json'
                }).done(function (data) {
                    var intervention = data.interventions;
                    afficherHistorique(intervention);
                });
            });
    </script>
    </body>
</html>
