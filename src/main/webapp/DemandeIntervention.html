<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Demande d'intervention</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    </head>
    <body>
        <a href="ClientConnecte.html"><img src="./img/logo.png" alt="Logo" width="100" height="100"></a>
        <input type='button' name='button1' value='Se déconnecter' onclick="self.location.href='Proactif.html'">
        <!-- attention il faut définir l'alignement des boutons class='pull-right'-->
        <hr/>
        
        <br/>
        Type : 
        <select name="liste" id="liste" size="1">
            <option value="value1">Incident</option>
            <option value="value2">Livraison</option>
            <option value="value3">Animal</option>
        </select><br/><br/>
        <p></p>
        Description : 
        <input type="text" name="text2" id="description" placeholder="Ajouter une description" /><br/><br/>
        <input type='button' name='button2' value='Valider' onclick="window.location.href='ClientConnecte.html'"> 
        
        <script>
            function afficherObjetLivraison() {
                $('p').append(' Objet à livrer : <input type="text" name="text3" id="objet" placeholder="Préciser l\'objet à livrer" /><br/><br/> ');
            }
            
            function afficherLivraison() {
                $('p').append(' Entreprise : <input type="text" name="text3" id="entreprise" placeholder="Préciser une entreprise" /><br/><br/> ');
            }
            
            function afficherAnimal() {
                $('p').append(' Animal : <input type="text" name="text4" id="animal" placeholder="Préciser l\'animal" /><br/><br/> ');
            }
            
            function effacer() {
                $('p').empty();
            }
            
            $('#liste').on('change', function() {
                // ajout d'un "handler" sur le clic du bouton de connexion
                var e = document.getElementById("liste");
                var strType = e.options[e.selectedIndex].value;
                if(strType=="value2"){
                    afficherObjetLivraison();
                    afficherLivraison();
                    effacer();
                } else if (strType=="value3") {
                    afficherAnimal();
                    effacer();
                    effacer();
                } else if (strType=="value1") {
                    effacer();
                    effacer();
                    effacer(); // Fonctionnement à vérifier
                } 
                
            });
    
            function creerIntervention() {
                var type = $('#liste').val();
                var objet = $('#objet').val();
                var entreprise = $('#entreprise').val();
                var animal = $('#animal').val();
                var description = $('#description').val();
                
                 $.ajax({
                        url: './ActionServlet',
                        method: 'POST',
                        data: {
                            action: 'intervention',
                            //je dois également envoyer id du client
                            //id: id,
                            type: type,
                            objet: objet,
                            entreprise: entreprise,
                            animal: animal,
                            description: description
                        },
                        dataType: 'json'
                    }).done(function (data) {
                        var confIntervention = data.Intervention;
                        if (confIntervention) {
                            alert('Demande d\'intervention envoyée');
                            window.location = "ClientConnecte.html";
                        } else {
                            alert('Echec de l\'envoie de demande d\'intervention, veuillez réessayer plus tard');
                        }
                    });
            }
        </script>
    </body>
    
</html>
