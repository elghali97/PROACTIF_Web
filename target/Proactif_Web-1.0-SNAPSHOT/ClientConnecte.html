<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Espace Client</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    </head>
    <body>
        <a href="ClientConnecte.html"><img src="./img/logo.png" alt="Logo" width="100" height="100"></a>
        <input type='button' name='button1' value='Se déconnecter' onclick="self.location.href='Proactif.html'">
        <!-- attention il faut définir l'alignement des boutons class='pull-right'-->
        <hr/>
    
    <center>
        
        <!-- Tableau historique des demandes -->
        
        <table width="100%" border="3" align="center">
        <tbody>
            <tr>
                <th>
                    <img src="./img/cloche.jpg" alt="Cloche" height="42" width="42">
                    Historiques des demandes :
                    <img src="./img/cloche.jpg" alt="Cloche" height="42" width="42">
                </th>
            </tr>
        <p></p>
            <!--<tr>
                <th>Intervention :</th>
            </tr>
            <tr>
                <th>Intervention :</th>
            </tr>-->
        </tbody>
        </table>
        
        
        <h1>
            <img src="./img/star.png" alt="Star" height="42" width="42">
            <input type='button' name='button2' value='Faire une nouvelle demande' onclick=demanderIntervention(idClient)>
            <img src="./img/star.png" alt="Star" height="42" width="42">
        </h1>
    </center>
    
    <script>
        function demanderIntervention (idClient) {
            window.location = "DemandeIntervention.html?idClient="+idClient;
        }
        
        function afficherHistorique (intervention) {
            //$('p').append(<tr><th>Intervention</th></tr>);
            $('p').append('<p> Type d\'intervention: '+intervention.type+'<\p>'
                                                  +'<p> Description de l\'intervention: '+intervention.description+'<\p>'
                                                  +'<p> [Client: <\p>'
                                                  +'<p>    Identite: '+intervention.client.nomClient+' '+intervention.client.prenomClient+'<\p>'
                                                  +'<p>    Adresse: '+intervention.client.adresseClient+'<\p>'
                                                  +'<p>    Telephone: '+intervention.client.numtelClient+']</p>');
        }
        
        $(document).ready(function () {
            
                var parameters = location.search.substring(1).split("=");
                idClient = unescape(parameters[1]);
                console.log("Identifiant client connecté"+ idClient);
                $.ajax({
                    url: './ActionServlet',
                    method: 'POST',
                    data: {
                        action: 'consulterHistoriqueClient',
                        IdClient: idClient
                    },
                    dataType: 'json'
                }).done(function (data) {
                    //$('#liste-interventions').empty();
                    var intervention = data.intervention;
                    console.log("Intervention à afficher "+ intervention);
                    afficherHistorique(intervention);
                    //idIntervention=intervention.idIntervention;
                    /*if(intervention.exist==true){
                        ajouter(intervention);
                    }else{
                        afficherErreur();
                    }*/
                });
            });
    </script>
    </body>
</html>
